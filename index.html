<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>社用車 利用開始（予約参照）</title>
</head>
<body>

<h1>社用車 利用開始</h1>

<!-- calendar_id を保持 -->
<input type="hidden" id="calendar_id">

<h2>予約情報（参照）</h2>

<div>
  <strong>業務コード：</strong>
  <span id="job_code_view">（未取得）</span>
</div>

<div>
  <strong>運転者：</strong>
  <span id="driver_name_view">（未取得）</span>
</div>

<div>
  <strong>予約時間：</strong>
  <span id="reserved_time_view">（未取得）</span>
</div>

<hr>

<a id="start_link" href="#">利用開始へ</a>

<script>
  // calendar_id を URL クエリから取得
  const params = new URLSearchParams(window.location.search);
  const calendarId = params.get("calendar_id");
  document.getElementById("calendar_id").value = calendarId;

  // start.html へ calendar_id を渡すだけ
  document.getElementById("start_link").href =
    "start.html?calendar_id=" + encodeURIComponent(calendarId);
  // 予約情報を取得
  fetch(
    "https://script.google.com/macros/s/AKfycbx1IiU6G463iRqi1MQq1EkhEcnJlZra-8ywfQO7WBwX3O2DcsffNIcDc4K0OZZDLGTt/exec"
    + "?calendar_id=" + encodeURIComponent(calendarId)
  )
  .then(res => res.json())
  .then(data => {
    if (!data.found) return;

    // タイトルから業務コード・名称を分ける（暫定）
    document.getElementById("job_code_view").textContent = data.title;
    document.getElementById("driver_name_view").textContent = "（予約参照）";
    document.getElementById("reserved_time_view").textContent =
      new Date(data.start).toLocaleString() +
      " ～ " +
      new Date(data.end).toLocaleString();
  });
</script>

</body>
</html>
