<script>
const params = new URLSearchParams(location.search);
const calendarId = params.get('calendar_id') || '';

const titleEl = document.getElementById('reservation-title');
const timeEl  = document.getElementById('reservation-time');
const startLink = document.getElementById('start-link');

// start.html には必ず行ける
startLink.href = `start.html?calendar_id=${encodeURIComponent(calendarId)}`;

// --- 初期表示（保険） ---
titleEl.textContent = '予約情報を取得できていません';
timeEl.textContent  = '（直接入力で開始できます）';

// --- 予約取得（失敗しても無視） ---
const SHEET_ID = '1wcrXfS43vpdhTrMtgBQufpXwAps7PF86mcoJsVHYt6s';
const GID = '0'; // ※正しくなくてもOK（今日は）
const FEED_URL =
  `https://spreadsheets.google.com/feeds/list/${SHEET_ID}/${GID}/public/values?alt=json`;

fetch(FEED_URL)
  .then(r => r.json())
  .then(json => {
    const entries = json.feed?.entry;
    if (!entries || entries.length === 0) return;

    // とりあえず先頭1件だけ表示（正しさは後回し）
    const e = entries[0];
    const title = e['gsx$eventtitle']?.$t || '（タイトル不明）';
    const start = e['gsx$starttime']?.$t || '';
    const end   = e['gsx$endtime']?.$t || '';

    titleEl.textContent = title;
    timeEl.textContent  = start && end ? `${start} ～ ${end}` : '（時刻未取得）';
  })
  .catch(err => {
    // 何もしない。画面は初期表示のまま。
    console.warn('予約取得失敗（無視）', err);
  });
</script>
