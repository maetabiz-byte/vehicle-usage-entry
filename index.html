<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>社用車 利用</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 16px; }
    h1 { font-size: 22px; margin-bottom: 12px; }
    .box { border: 1px solid #ccc; padding: 12px; }
    .job-code { font-weight: bold; }
    .time { margin-top: 6px; }
    .warn { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h1>社用車 利用</h1>
<div id="content"></div>

<script>
/* ===============================
   JSONP callback（必須）
   =============================== */
function handleReservation(data) {
  var content = document.getElementById('content');

  // データ確認用（まずは必ず見えることを優先）
  content.innerHTML =
    '<div class="box">'
    + '<div class="job-code">DEBUG: JSONP受信成功</div>'
    + '<pre style="white-space:pre-wrap;font-size:12px;">'
    + JSON.stringify(data, null, 2)
    + '</pre>'
    + '</div>';
}

/* ===============================
   JSONP 読み込み（XHR禁止）
   =============================== */
(function () {
  var params = new URLSearchParams(window.location.search);
  var calendarId = params.get('calendar_id');
  var content = document.getElementById('content');

  if (!calendarId) {
    content.innerHTML = '<div class="warn">calendar_id がありません</div>';
    return;
  }

  var GAS_URL =
    'https://script.google.com/macros/s/AKfycbx1IiU6G463iRqi1MQq1EkhEcnJlZra-8ywfQO7WBwX3O2DcsffNIcDc4K0OZZDLGTt/exec';

  var script = document.createElement('script');
  script.src =
    GAS_URL
    + '?calendar_id=' + encodeURIComponent(calendarId)
    + '&callback=handleReservation';

  document.body.appendChild(script);
})();
</script>

</body>
</html>
