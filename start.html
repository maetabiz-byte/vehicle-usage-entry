<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>社用車 利用実績 開始</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; margin: 16px; }
    .section { margin-bottom: 16px; }
    label { display: block; margin-top: 8px; }
    input, select { width: 100%; padding: 6px; font-size: 1em; }
    button { margin-top: 16px; padding: 8px 16px; font-size: 1em; }
    .error { color: #b00000; font-weight: bold; }
  </style>
</head>
<body>

<h2>社用車 利用実績 開始</h2>

<div id="content"></div>

<script>
const WEBAPP_URL =
  'https://script.google.com/macros/s/AKfycbx1IiU6G463iRqi1MQq1EkhEcnJlZra-8ywfQO7WBwX3O2DcsffNIcDc4K0OZZDLGTt/exec';

const params = new URLSearchParams(window.location.search);
const calendarId = params.get('calendar_id');
const jobCode = params.get('job_code') || '';
const jobName = params.get('job_name') || '';

const content = document.getElementById('content');

if (!calendarId) {
  content.innerHTML = '<div class="error">calendar_id がありません。</div>';
} else {

  content.innerHTML = `
    <form id="startForm" method="POST" action="${WEBAPP_URL}">
      <input type="hidden" name="calendar_id" value="${calendarId}">
      <input type="hidden" name="submit_token" id="submit_token">

      <div class="section">
        <label>業務コード
          <input type="text" name="job_code" value="${jobCode}">
        </label>
        <label>業務内容
          <input type="text" name="job_name" value="${jobName}">
        </label>
        <label>運転者名
          <input type="text" name="driver_name">
        </label>
      </div>

      <div class="section">
        <label>開始時走行距離
          <input type="number" name="start_odometer" required>
        </label>
      </div>

      <div class="section">
        <label>酒気帯び確認方法
          <select name="alcohol_check_method" id="alcohol_method" required>
            <option value="">選択してください</option>
            <option value="対面">対面</option>
            <option value="非対面">非対面</option>
          </select>
        </label>
        <label>測定値
          <input type="number" name="alcohol_value" id="alcohol_value" step="0.01" required>
        </label>
        <div id="alcoholError" class="error"></div>
      </div>

      <button type="submit" id="submitBtn">開始を登録する</button>
    </form>
  `;

  document.getElementById('submit_token').value =
    crypto.randomUUID();

  const alcoholValue = document.getElementById('alcohol_value');
  const submitBtn = document.getElementById('submitBtn');
  const errorDiv = document.getElementById('alcoholError');

  alcoholValue.addEventListener('input', () => {
    const v = Number(alcoholValue.value);
    if (v !== 0) {
      submitBtn.disabled = true;
      errorDiv.textContent = '酒気帯びのため登録できません。';
    } else {
      submitBtn.disabled = false;
      errorDiv.textContent = '';
    }
  });
}
</script>

</body>
</html>
